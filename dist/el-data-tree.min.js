var ElDataTree=function(e,t){"use strict";function n(e){n.installed||(n.installed=!0,e.component("ElDataTree",r))}t=t&&t.hasOwnProperty("default")?t.default:t,function(){if("undefined"!=typeof document){var e=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style"),n=".el-data-tree .data-tree-title { padding: 8px; font-weight: bold; display: flex; align-items: center; justify-content: space-between; } .el-data-tree .data-tree-title .el-icon-plus { cursor: pointer; } .el-data-tree .data-tree { padding-top: 8px; } .el-data-tree .custom-tree-node { overflow: hidden; flex: 1; display: flex; align-items: center; justify-content: space-between; font-size: 14px; padding-right: 8px; } .el-data-tree .custom-tree-node-label { overflow: hidden; text-overflow: ellipsis; } ";t.type="text/css",t.styleSheet?t.styleSheet.cssText=n:t.appendChild(document.createTextNode(n)),e.appendChild(t)}}();var i={highlightCurrent:!0,props:{children:"children",label:"name"},nodeKey:"id"},a=function(e){return e.replace(/-(\w)/g,function(e,t){return t?t.toUpperCase():""})},r={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"el-data-tree"},[e.hasTitle?e._t("title",[n("p",{staticClass:"data-tree-title"},[e._v(e._s(e.title)),n("i",{staticClass:"el-icon-plus",on:{click:e.onDefaultNew}})])]):e._e(),e._v(" "),e.showFilter?n("el-input",{attrs:{placeholder:"查询",clearable:""},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}}):e._e(),e._v(" "),n("el-tree",e._g(e._b({directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"tree",staticClass:"data-tree",attrs:{data:e.treeData,filterNodeMethod:e.filterNode,defaultExpandedKeys:e.expandedKeys},on:{"node-expand":e.handleNodeExpand,"node-collapse":e.handleNodeCollapse,"check-change":e.handleCheckChange},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.node,a=t.data;return n("span",{staticClass:"custom-tree-node"},[n("span",{staticClass:"custom-tree-node-label"},[e._v(e._s(i.label))]),e._v(" "),e.hasOperation?n("span",{on:{click:function(e){return e.stopPropagation()}}},[n("el-dropdown",{attrs:{trigger:"click"},on:{command:function(t){return e.handleCommand(t,a,i)}}},[n("span",{staticClass:"el-dropdown-link"},[n("i",{staticClass:"el-icon-more"})]),e._v(" "),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e.hasNew?n("el-dropdown-item",{attrs:{command:"new"}},[e._v(e._s(e.newText))]):e._e(),e._v(" "),e.hasEdit?n("el-dropdown-item",{attrs:{command:"edit"}},[e._v(e._s(e.editText))]):e._e(),e._v(" "),e._l(e.extraButtons.filter(function(e){return!e.show||e.show(a,i)}),function(t,i){return n("el-dropdown-item",e._b({key:i,attrs:{command:t.text}},"el-dropdown-item",t,!1),[e._v(" "+e._s(t.text)+" ")])}),e._v(" "),e.hasDelete?n("el-dropdown-item",{attrs:{command:"delete"}},[e._v(e._s(e.deleteText))]):e._e()],2)],1)],1):e._e()])}}])},"el-tree",e.treeAttributes,!1),e.$listeners)),e._v(" "),n("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t},close:e.closeDialog}},[n("el-form-renderer",e._b({ref:"dialogForm",attrs:{content:e.form}},"el-form-renderer",e.formAttrs,!1),[e._t("form")],2),e._v(" "),n("div",{attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{size:"small"},on:{click:e.cancel}},[e._v("取 消")]),e._v(" "),n("el-button",{attrs:{type:"primary",loading:e.confirmLoading,size:"small"},on:{click:e.confirm}},[e._v("确 定")])],1)],1)],2)},staticRenderFns:[],name:"ElDataTree",props:{title:{type:String,default:""},treeAttrs:{type:Object,default:function(){return{}}},url:{type:String,default:""},parentKey:{type:String,default:"parentId"},dataPath:{type:String,default:"payload.content"},showFilter:{type:Boolean,default:!1},checkedKeys:{type:Array,default:function(){return[]}},extraButtons:{type:Array,default:function(){return[]}},form:{type:Array,default:function(){return[]}},formAttrs:{type:Object,default:function(){return{}}},extraParams:{type:Object,default:function(){return{}}},customQuery:{type:Object,default:function(){return{}}},hasOperation:{type:Boolean,default:!0},hasTitle:{type:Boolean,default:!1},hasDelete:{type:Boolean,default:!0},hasNew:{type:Boolean,default:!0},hasEdit:{type:Boolean,default:!0},transform:{type:Function},onNew:{type:Function},onEdit:{type:Function},onDelete:{type:Function},beforeConfirm:{type:Function,default:function(){return Promise.resolve()}},newText:{type:String,default:"新增"},editText:{type:String,default:"修改"},deleteText:{type:String,default:"删除"}},data:function(){return{treeData:[],filterText:"",loading:!1,dialogTitle:"",dialogVisible:!1,isNew:!0,isEdit:!1,confirmLoading:!1,row:{},expandedKeys:[]}},computed:{camelizeTreeAttrs:function(){var e=this.treeAttrs;return Object.keys(e).reduce(function(t,n){return t[a(n)]=e[n],t},{})},treeAttributes:function(){return Object.assign({},i,this.camelizeTreeAttrs)}},watch:{url:{handler:function(){this.fetchData()},immediate:!0},filterText:function(e){this.$refs.tree.filter(e)},checkedKeys:function(e){this.updateCheckedKeys(e)}},mounted:function(){this.treeAttributes.defaultExpandedKeys&&(this.expandedKeys=this.expandedKeys.concat(this.treeAttributes.defaultExpandedKeys))},methods:{fetchData:function(){var e=this;if(!this.url)return console.warn("ELDataTree: url 为空, 不发送请求"),!1;this.loading=!0,this.$axios.get(this.url,{params:this.customQuery}).then(function(n){var i=t(n,e.dataPath)||[];e.treeData=e.transform&&e.transform(i)||i,e.updateCheckedKeys(e.checkedKeys),e.$emit("loaded",e.treeData,n)}).catch(function(t){e.$emit("error",t)}).finally(function(){e.loading=!1})},filterNode:function(e,t){return!e||-1!==t[this.treeAttributes.props.label].indexOf(e)},getTree:function(){return this.$refs.tree},handleCheckChange:function(){var e=this.$refs.tree.getCheckedNodes(!1,!0),t=this.treeAttributes.nodeKey;this.$emit("update:checkedKeys",e.map(function(e){return e[t]}))},updateCheckedKeys:function(e){var t=this.treeAttributes,n=function e(t,n){return t.reduce(function(t,i){return t.concat(i[n]?e(i[n]):i)},[])}(this.treeData,t.props.children).filter(function(n){return e.indexOf(n[t.nodeKey])>-1}).map(function(e){return e[t.nodeKey]});this.$refs.tree.setCheckedKeys(n)},handleCommand:function(e,t,n){var i={new:this.onDefaultNew,edit:this.onDefaultEdit,delete:this.onDefaultDelete};if(i[e])return void i[e](t,n);var a=this.extraButtons.find(function(t){return t.text===e});a&&"function"==typeof a.atClick&&a.atClick(t,n)},onDefaultNew:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.row=e,this.isNew=!0,this.isEdit=!1,this.dialogTitle=this.newText,this.dialogVisible=!0},onDefaultEdit:function(e){var t=this;this.row=e,this.isNew=!1,this.isEdit=!0,this.dialogTitle=this.editText,this.dialogVisible=!0,this.$nextTick(function(){t.$refs.dialogForm.updateForm(e)})},onDefaultDelete:function(e,t){var n=this;this.$confirm("确认删除吗","提示",{type:"warning",beforeClose:function(i,a,r){if("confirm"!==i)return void r();a.confirmButtonLoading=!0,(n.onDelete&&n.onDelete(e,t)||n.$axios.delete(n.url+"/"+e[n.treeAttributes.nodeKey])).then(function(){r(),n.showMessage(),n.fetchData()}).catch(function(e){n.$emit("error",e)}).finally(function(){a.confirmButtonLoading=!1})}}).catch(function(e){n.$emit("error",e)})},handleNodeExpand:function(e){var t=this.treeAttributes.nodeKey;this.expandedKeys.push(e[t])},handleNodeCollapse:function(e){var t=this.treeAttributes.nodeKey;this.expandedKeys=this.expandedKeys.filter(function(n){return n!==e[t]})},cancel:function(){this.dialogVisible=!1},confirm:function(){var e=this;this.$refs.dialogForm.validate(function(t){if(!t)return!1;var n=e.isNew?e.treeAttributes.nodeKey:e.parentKey,i=Object.assign({parentId:e.row[n]},e.$refs.dialogForm.getFormValue(),e.extraParams);e.beforeConfirm(i,e.isNew).then(function(){var t="isNew",n="onNew";if(e.isEdit&&(t="isEdit",n="onEdit"),e[t]&&e[n])return e.confirmLoading=!0,void e[n](i,e.row).then(function(t){e.fetchData(),e.showMessage(!0),e.cancel()}).catch(function(t){e.$emit("error",t)}).finally(function(t){e.confirmLoading=!1});var a="post",r=e.url;e.isEdit&&(a="put",r+="/"+e.row[e.treeAttributes.nodeKey]),e.confirmLoading=!0,e.$axios[a](r,i,{params:e.customQuery}).then(function(t){e.showMessage(),e.fetchData(),e.cancel()}).catch(function(t){e.$emit("error",t)}).finally(function(t){e.confirmLoading=!1})}).catch(function(e){})})},closeDialog:function(){this.isNew=!1,this.isEdit=!1,this.confirmLoading=!1,this.$refs.dialogForm.resetFields()},showMessage:function(){!(arguments.length>0&&void 0!==arguments[0])||arguments[0]?this.$message({type:"success",message:"操作成功"}):this.$message({type:"error",message:"操作失败"})}}},o={install:n},s=null;return"undefined"!=typeof window?s=window.Vue:"undefined"!=typeof global&&(s=global.Vue),s&&s.use(o),e.install=n,e.default=r,e}({},_get);
